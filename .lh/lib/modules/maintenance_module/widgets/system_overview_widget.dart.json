{
    "sourceFile": "lib/modules/maintenance_module/widgets/system_overview_widget.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1726411660068,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1726411660068,
            "name": "Commit-0",
            "content": "// lib/widgets/system_overview_widget.dart\r\nimport 'package:flutter/material.dart';\r\nimport 'package:flutter_svg/flutter_svg.dart';\r\nimport 'package:provider/provider.dart';\r\nimport '../models/component.dart';\r\nimport '../providers/maintenance_ald_system_provider.dart';\r\n\r\nclass SystemOverviewWidget extends StatelessWidget {\r\n  final List<Component> components;\r\n  final Function(Component) onComponentTap;\r\n\r\n  const SystemOverviewWidget({\r\n    Key? key,\r\n    required this.components,\r\n    required this.onComponentTap,\r\n  }) : super(key: key);\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Card(\r\n      child: Padding(\r\n        padding: const EdgeInsets.all(16.0),\r\n        child: Column(\r\n          crossAxisAlignment: CrossAxisAlignment.start,\r\n          children: [\r\n            Text(\r\n              'System Overview',\r\n              style: Theme.of(context).textTheme.titleLarge,\r\n            ),\r\n            SizedBox(height: 16),\r\n            AspectRatio(\r\n              aspectRatio: 2.5, // Adjust this value to fit your layout\r\n              child: SystemDiagram(),\r\n            ),\r\n          ],\r\n        ),\r\n      ),\r\n    );\r\n  }\r\n}\r\n\r\nclass SystemDiagram extends StatelessWidget {\r\n  const SystemDiagram({Key? key}) : super(key: key);\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Consumer<MaintenanceSystemStateProvider>(\r\n      builder: (context, aldSystem, child) {\r\n        return LayoutBuilder(\r\n          builder: (context, constraints) {\r\n            return GestureDetector(\r\n              onTapDown: (TapDownDetails details) {\r\n                final RenderBox box = context.findRenderObject() as RenderBox;\r\n                final localPosition = box.globalToLocal(details.globalPosition);\r\n                final relativeX = localPosition.dx / constraints.maxWidth;\r\n                final relativeY = localPosition.dy / constraints.maxHeight;\r\n                _handleTap(context, relativeX, relativeY);\r\n              },\r\n              child: SvgPicture.string(\r\n                _getSvgContent(aldSystem),\r\n                width: constraints.maxWidth,\r\n                height: constraints.maxHeight,\r\n              ),\r\n            );\r\n          },\r\n        );\r\n      },\r\n    );\r\n  }\r\n\r\n  void _handleTap(BuildContext context, double relativeX, double relativeY) {\r\n    final aldSystem = Provider.of<MaintenanceSystemStateProvider>(context, listen: false);\r\n    if (relativeY > 0.375 && relativeY < 0.625) {\r\n      if (relativeX < 0.13) aldSystem.toggleN2Gen();\r\n      else if (relativeX < 0.26) aldSystem.toggleMFC();\r\n      else if (relativeX < 0.54) aldSystem.toggleFrontlineHeater();\r\n      else if (relativeX < 0.72) _showChamberDialog(context);\r\n      else if (relativeX < 0.85) aldSystem.toggleBacklineHeater();\r\n      else if (relativeX < 0.93) _showPCDialog(context);\r\n      else aldSystem.togglePump();\r\n    } else if (relativeY > 0.75 && relativeY < 0.85) {\r\n      if (relativeX > 0.365 && relativeX < 0.405) aldSystem.toggleValve('v1');\r\n      else if (relativeX > 0.445 && relativeX < 0.485) aldSystem.toggleValve('v2');\r\n    } else if (relativeY > 0.9) {\r\n      if (relativeX > 0.35 && relativeX < 0.42) aldSystem.toggleHeater('h1');\r\n      else if (relativeX > 0.43 && relativeX < 0.5) aldSystem.toggleHeater('h2');\r\n    }\r\n  }\r\n\r\n  void _showChamberDialog(BuildContext context) {\r\n    showDialog(\r\n      context: context,\r\n      builder: (BuildContext context) {\r\n        return AlertDialog(\r\n          title: Text('Chamber Information'),\r\n          content: Text('The chamber is always active during the process.'),\r\n          actions: <Widget>[\r\n            TextButton(\r\n              child: Text('Close'),\r\n              onPressed: () {\r\n                Navigator.of(context).pop();\r\n              },\r\n            ),\r\n          ],\r\n        );\r\n      },\r\n    );\r\n  }\r\n\r\n  void _showPCDialog(BuildContext context) {\r\n    showDialog(\r\n      context: context,\r\n      builder: (BuildContext context) {\r\n        return AlertDialog(\r\n          title: Text('Pressure Controller Information'),\r\n          content: Text('The pressure controller is always active to maintain the desired pressure.'),\r\n          actions: <Widget>[\r\n            TextButton(\r\n              child: Text('Close'),\r\n              onPressed: () {\r\n                Navigator.of(context).pop();\r\n              },\r\n            ),\r\n          ],\r\n        );\r\n      },\r\n    );\r\n  }\r\n\r\n  String _getSvgContent(MaintenanceSystemStateProvider aldSystem) {\r\n    return '''\r\n    <svg viewBox=\"0 0 1000 400\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <g>\r\n        <path d=\"M50 200 H950\" stroke=\"#BBBBBB\" stroke-width=\"2\" fill=\"none\"/>\r\n        <path d=\"M385 200 V300 M465 200 V300 M385 340 V370 M465 340 V370\" stroke=\"#BBBBBB\" stroke-width=\"2\" fill=\"none\"/>\r\n      </g>\r\n      <g>\r\n        <rect x=\"50\" y=\"130\" width=\"100\" height=\"120\" fill=\"#2C3E50\" stroke=\"#BBBBBB\" stroke-width=\"2\"/>\r\n        <rect x=\"50\" y=\"130\" width=\"100\" height=\"120\" fill=\"${aldSystem.n2GenActive ? '#3498DB' : '#34495E'}\" fill-opacity=\"0.6\"/>\r\n        <text x=\"100\" y=\"200\" text-anchor=\"middle\" font-size=\"18\" fill=\"#FFFFFF\">N2 GEN</text>\r\n        \r\n        <rect x=\"170\" y=\"130\" width=\"100\" height=\"120\" fill=\"#2C3E50\" stroke=\"#BBBBBB\" stroke-width=\"2\"/>\r\n        <rect x=\"170\" y=\"130\" width=\"100\" height=\"120\" fill=\"${aldSystem.mfcActualFlow > 0 ? '#3498DB' : '#34495E'}\" fill-opacity=\"0.6\"/>\r\n        <text x=\"220\" y=\"200\" text-anchor=\"middle\" font-size=\"18\" fill=\"#FFFFFF\">MFC</text>\r\n        \r\n        <rect x=\"290\" y=\"130\" width=\"250\" height=\"120\" fill=\"#2C3E50\" stroke=\"#BBBBBB\" stroke-width=\"2\"/>\r\n        <rect x=\"290\" y=\"130\" width=\"250\" height=\"120\" fill=\"${aldSystem.frontlineHeaterActive ? '#E74C3C' : '#34495E'}\" fill-opacity=\"0.6\"/>\r\n        <text x=\"415\" y=\"200\" text-anchor=\"middle\" font-size=\"18\" fill=\"#FFFFFF\">Frontline Heater</text>\r\n        \r\n        <rect x=\"560\" y=\"130\" width=\"150\" height=\"120\" fill=\"#2C3E50\" stroke=\"#BBBBBB\" stroke-width=\"2\"/>\r\n        <rect x=\"560\" y=\"130\" width=\"150\" height=\"120\" fill=\"#3498DB\" fill-opacity=\"0.6\"/>\r\n        <text x=\"635\" y=\"200\" text-anchor=\"middle\" font-size=\"18\" fill=\"#FFFFFF\">CHAMBER</text>\r\n        \r\n        <rect x=\"730\" y=\"130\" width=\"100\" height=\"120\" fill=\"#2C3E50\" stroke=\"#BBBBBB\" stroke-width=\"2\"/>\r\n        <rect x=\"730\" y=\"130\" width=\"100\" height=\"120\" fill=\"${aldSystem.backlineHeaterActive ? '#E74C3C' : '#34495E'}\" fill-opacity=\"0.6\"/>\r\n        <text x=\"780\" y=\"200\" text-anchor=\"middle\" font-size=\"18\" fill=\"#FFFFFF\">Backline</text>\r\n        \r\n        <rect x=\"850\" y=\"130\" width=\"70\" height=\"120\" fill=\"#2C3E50\" stroke=\"#BBBBBB\" stroke-width=\"2\"/>\r\n        <rect x=\"850\" y=\"130\" width=\"70\" height=\"120\" fill=\"#3498DB\" fill-opacity=\"0.6\"/>\r\n        <text x=\"885\" y=\"200\" text-anchor=\"middle\" font-size=\"18\" fill=\"#FFFFFF\">PC</text>\r\n        \r\n        <rect x=\"940\" y=\"130\" width=\"70\" height=\"120\" fill=\"#2C3E50\" stroke=\"#BBBBBB\" stroke-width=\"2\"/>\r\n        <rect x=\"940\" y=\"130\" width=\"70\" height=\"120\" fill=\"${aldSystem.pumpActive ? '#3498DB' : '#34495E'}\" fill-opacity=\"0.6\"/>\r\n        <text x=\"975\" y=\"200\" text-anchor=\"middle\" font-size=\"18\" fill=\"#FFFFFF\">PU</text>\r\n        \r\n        <circle cx=\"385\" cy=\"320\" r=\"25\" fill=\"#2C3E50\" stroke=\"#BBBBBB\" stroke-width=\"2\"/>\r\n        <circle cx=\"385\" cy=\"320\" r=\"25\" fill=\"${aldSystem.v1Open ? '#2ECC71' : '#E74C3C'}\" fill-opacity=\"0.6\"/>\r\n        <text x=\"385\" y=\"327\" text-anchor=\"middle\" font-size=\"16\" fill=\"#FFFFFF\">V1</text>\r\n        \r\n        <circle cx=\"465\" cy=\"320\" r=\"25\" fill=\"#2C3E50\" stroke=\"#BBBBBB\" stroke-width=\"2\"/>\r\n        <circle cx=\"465\" cy=\"320\" r=\"25\" fill=\"${aldSystem.v2Open ? '#2ECC71' : '#E74C3C'}\" fill-opacity=\"0.6\"/>\r\n        <text x=\"465\" y=\"327\" text-anchor=\"middle\" font-size=\"16\" fill=\"#FFFFFF\">V2</text>\r\n        \r\n        <rect x=\"350\" y=\"360\" width=\"70\" height=\"40\" fill=\"#2C3E50\" stroke=\"#BBBBBB\" stroke-width=\"2\"/>\r\n        <rect x=\"350\" y=\"360\" width=\"70\" height=\"40\" fill=\"${aldSystem.h1Active ? '#E74C3C' : '#34495E'}\" fill-opacity=\"0.6\"/>\r\n        <text x=\"385\" y=\"385\" text-anchor=\"middle\" font-size=\"16\" fill=\"#FFFFFF\">H1</text>\r\n        \r\n        <rect x=\"430\" y=\"360\" width=\"70\" height=\"40\" fill=\"#2C3E50\" stroke=\"#BBBBBB\" stroke-width=\"2\"/>\r\n        <rect x=\"430\" y=\"360\" width=\"70\" height=\"40\" fill=\"${aldSystem.h2Active ? '#E74C3C' : '#34495E'}\" fill-opacity=\"0.6\"/>\r\n        <text x=\"465\" y=\"385\" text-anchor=\"middle\" font-size=\"16\" fill=\"#FFFFFF\">H2</text>\r\n      </g>\r\n    </svg>\r\n    ''';\r\n  }\r\n}"
        }
    ]
}